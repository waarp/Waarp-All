<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>FtpArgs.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Waarp Extensions for JRE 8 and greater</a> &gt; <a href="../index.html" class="el_bundle">WaarpR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.context.task</a> &gt; <span class="el_source">FtpArgs.java</span></div><h1>FtpArgs.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package org.waarp.openr66.context.task;

import org.apache.commons.cli.CommandLine;
import org.apache.commons.cli.CommandLineParser;
import org.apache.commons.cli.DefaultParser;
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.ParseException;
import org.waarp.common.digest.FilesystemBasedDigest.DigestAlgo;
import org.waarp.openr66.context.task.exception.OpenR66RunnerErrorException;

import java.io.File;

/**
 * Class to parse arguments for FTP command
 */
<span class="fc" id="L38">public class FtpArgs {</span>
<span class="fc" id="L39">  private static final Option FILE_OPTION =</span>
<span class="fc" id="L40">      Option.builder(&quot;file&quot;).required(true).hasArg(true)</span>
<span class="fc" id="L41">            .desc(&quot;Specify the file path to operate on&quot;).build();</span>
<span class="fc" id="L42">  private static final Option HOST_OPTION =</span>
<span class="fc" id="L43">      Option.builder(&quot;to&quot;).required(true).hasArg(true)</span>
<span class="fc" id="L44">            .desc(&quot;Specify the requested Host&quot;).build();</span>
<span class="fc" id="L45">  private static final Option PORT_OPTION =</span>
<span class="fc" id="L46">      Option.builder(&quot;port&quot;).required(true).hasArg(true)</span>
<span class="fc" id="L47">            .desc(&quot;Specify the port on remote host to use&quot;).type(Number.class)</span>
<span class="fc" id="L48">            .build();</span>
<span class="fc" id="L49">  private static final Option USER_OPTION =</span>
<span class="fc" id="L50">      Option.builder(&quot;user&quot;).required(true).hasArg(true)</span>
<span class="fc" id="L51">            .desc(&quot;Specify the user on remote host to use&quot;).build();</span>
<span class="fc" id="L52">  private static final Option PWD_OPTION =</span>
<span class="fc" id="L53">      Option.builder(&quot;pwd&quot;).required(true).hasArg(true)</span>
<span class="fc" id="L54">            .desc(&quot;Specify the password on remote host to use&quot;).build();</span>
<span class="fc" id="L55">  private static final Option ACCOUNT_OPTION =</span>
<span class="fc" id="L56">      Option.builder(&quot;account&quot;).hasArg(true)</span>
<span class="fc" id="L57">            .desc(&quot;Specify the account on remote host to use&quot;).build();</span>
<span class="fc" id="L58">  private static final Option MODE_OPTION = Option.builder(&quot;mode&quot;).hasArg(true)</span>
<span class="fc" id="L59">                                                  .desc(</span>
                                                      &quot;Specify the mode active of&quot; +
                                                      &quot; passive to use&quot;)
<span class="fc" id="L62">                                                  .build();</span>
<span class="fc" id="L63">  private static final Option SSL_OPTION = Option.builder(&quot;ssl&quot;).hasArg(true)</span>
<span class="fc" id="L64">                                                 .desc(</span>
                                                     &quot;Specify the ssl mode to use &quot; +
                                                     &quot;between no / explicit / implicit&quot;)
<span class="fc" id="L67">                                                 .build();</span>
<span class="fc" id="L68">  private static final Option CWD_OPTION = Option.builder(&quot;cwd&quot;).hasArg(true)</span>
<span class="fc" id="L69">                                                 .desc(</span>
                                                     &quot;Specify the remote path on &quot; +
                                                     &quot;remote host to use&quot;)
<span class="fc" id="L72">                                                 .build();</span>
<span class="fc" id="L73">  private static final Option DIGEST_OPTION =</span>
<span class="fc" id="L74">      Option.builder(&quot;digest&quot;).hasArg(true).desc(</span>
          &quot;Specify the digest to use between crc, md5, &quot; +
<span class="fc" id="L76">          &quot;sha1, sha256, sha384, sha512&quot;).build();</span>
<span class="fc" id="L77">  private static final Option PRE_OPTION = Option.builder(&quot;pre&quot;).hasArg(true)</span>
<span class="fc" id="L78">                                                 .desc(</span>
                                                     &quot;Specify the extra command as &quot; +
                                                     &quot;pre operation to use, using ',' as &quot; +
                                                     &quot;separator of arguments&quot;)
<span class="fc" id="L82">                                                 .build();</span>
<span class="fc" id="L83">  private static final Option POST_OPTION = Option.builder(&quot;post&quot;).hasArg(true)</span>
<span class="fc" id="L84">                                                  .desc(</span>
                                                      &quot;Specify the extra command &quot; +
                                                      &quot;as post operation to use, &quot; +
                                                      &quot;using ',' as&quot; +
                                                      &quot; separator of arguments&quot;)
<span class="fc" id="L89">                                                  .build();</span>
<span class="fc" id="L90">  private static final Option CMD_OPTION =</span>
<span class="fc" id="L91">      Option.builder(&quot;command&quot;).hasArg(true)</span>
<span class="fc" id="L92">            .desc(&quot;Specify the command as one of get, put, append &quot;).build();</span>

<span class="fc" id="L94">  private static final Options FTP_OPTIONS =</span>
<span class="fc" id="L95">      new Options().addOption(FILE_OPTION).addOption(HOST_OPTION)</span>
<span class="fc" id="L96">                   .addOption(PORT_OPTION).addOption(USER_OPTION)</span>
<span class="fc" id="L97">                   .addOption(PWD_OPTION).addOption(ACCOUNT_OPTION)</span>
<span class="fc" id="L98">                   .addOption(MODE_OPTION).addOption(SSL_OPTION)</span>
<span class="fc" id="L99">                   .addOption(CWD_OPTION).addOption(DIGEST_OPTION)</span>
<span class="fc" id="L100">                   .addOption(PRE_OPTION).addOption(CMD_OPTION)</span>
<span class="fc" id="L101">                   .addOption(POST_OPTION);</span>
<span class="fc" id="L102">  private String filepath = null;</span>
<span class="fc" id="L103">  private String filename = null;</span>
<span class="fc" id="L104">  private String requested = null;</span>
<span class="fc" id="L105">  private int port = 21;</span>
<span class="fc" id="L106">  private String user = null;</span>
<span class="fc" id="L107">  private String pwd = null;</span>
<span class="fc" id="L108">  private String acct = null;</span>
<span class="fc" id="L109">  private boolean isPassive = true;</span>
<span class="fc" id="L110">  private int ssl = 0; // -1 native, 1 auth</span>
<span class="fc" id="L111">  private String cwd = null;</span>
<span class="fc" id="L112">  private DigestAlgo digest = null; // 1 CRC, 2 MD5, 3 SHA1, 4 SHA256, 5 SHA384,</span>
  // 6 SHA512
<span class="fc" id="L114">  private String digestCommand = null;</span>
  private String command;
<span class="fc" id="L116">  private int codeCommand = 0; // -1 get, 1 put, 2 append</span>
<span class="fc" id="L117">  private String preArgs = null;</span>
<span class="fc" id="L118">  private String postArgs = null;</span>

  /**
   * Print to standard output the help of this command
   */
  public static void printHelp() {
<span class="nc" id="L124">    final HelpFormatter formatter = new HelpFormatter();</span>
<span class="nc" id="L125">    formatter.printHelp(&quot;FtpArgs&quot;, FTP_OPTIONS);</span>
<span class="nc" id="L126">  }</span>

  /**
   * &quot;-file filepath &lt;br&gt; -to requestedHost &lt;br&gt; -port port &lt;br&gt; -user user &lt;br&gt; -pwd pwd &lt;br&gt; [-account
   * account] &lt;br&gt; [-mode active/passive] &lt;br&gt; [-ssl no/implicit/explicit]&lt;br&gt; [-cwd remotepath] &lt;br&gt; [-digest
   * (crc,md5,sha1)] &lt;br&gt; [-pre extraCommand1 with ',' as separator of arguments] &lt;br&gt; -command command from
   * (get,put,append) &lt;br&gt; [-post extraCommand2 with ',' as separator of arguments]&quot; &lt;br&gt;
   * &lt;br&gt;
   *
   * @param args must be already replaced values (getReplacedValue)
   */
  public static FtpArgs getFtpArgs(final String[] args)
      throws OpenR66RunnerErrorException {
<span class="fc" id="L139">    final FtpArgs ftpArgs = new FtpArgs();</span>
<span class="fc" id="L140">    final CommandLineParser parser = new DefaultParser();</span>
    try {
<span class="fc" id="L142">      final CommandLine cmd = parser.parse(FTP_OPTIONS, args, true);</span>

<span class="fc" id="L144">      ftpArgs.setFilepath(cmd.getOptionValue(&quot;file&quot;));</span>
<span class="fc" id="L145">      ftpArgs.setFilename(new File(ftpArgs.getFilepath()).getName());</span>
<span class="fc" id="L146">      ftpArgs.setRequested(cmd.getOptionValue(&quot;to&quot;));</span>
      try {
<span class="fc" id="L148">        ftpArgs.setPort(Integer.parseInt(cmd.getOptionValue(&quot;port&quot;)));</span>
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        if (ftpArgs.getPort() &lt; 0) {</span>
<span class="nc" id="L150">          throw new NumberFormatException(&quot;Port must be positive&quot;);</span>
        }
<span class="fc" id="L152">      } catch (final NumberFormatException e) {</span>
<span class="fc" id="L153">        throw new OpenR66RunnerErrorException(e);</span>
<span class="fc" id="L154">      }</span>
<span class="fc" id="L155">      ftpArgs.setUser(cmd.getOptionValue(&quot;user&quot;));</span>
<span class="fc" id="L156">      ftpArgs.setPwd(cmd.getOptionValue(&quot;pwd&quot;));</span>
<span class="fc bfc" id="L157" title="All 2 branches covered.">      if (cmd.hasOption(&quot;account&quot;)) {</span>
<span class="fc" id="L158">        ftpArgs.setAcct(cmd.getOptionValue(&quot;account&quot;));</span>
      }
<span class="fc bfc" id="L160" title="All 2 branches covered.">      if (cmd.hasOption(&quot;mode&quot;)) {</span>
<span class="fc" id="L161">        ftpArgs.setPassive(</span>
<span class="fc" id="L162">            &quot;passive&quot;.equalsIgnoreCase(cmd.getOptionValue(&quot;mode&quot;)));</span>
      }
<span class="fc bfc" id="L164" title="All 2 branches covered.">      if (cmd.hasOption(&quot;ssl&quot;)) {</span>
<span class="fc" id="L165">        final String ssl = cmd.getOptionValue(&quot;ssl&quot;);</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">        if (&quot;implicit&quot;.equalsIgnoreCase(ssl)) {</span>
<span class="fc" id="L167">          ftpArgs.setSsl(-1);</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">        } else if (&quot;explicit&quot;.equalsIgnoreCase(ssl)) {</span>
<span class="fc" id="L169">          ftpArgs.setSsl(1);</span>
        } else {
<span class="fc" id="L171">          ftpArgs.setSsl(0);</span>
        }
      }
<span class="fc bfc" id="L174" title="All 2 branches covered.">      if (cmd.hasOption(&quot;cwd&quot;)) {</span>
<span class="fc" id="L175">        ftpArgs.setCwd(cmd.getOptionValue(&quot;cwd&quot;));</span>
      }
<span class="fc bfc" id="L177" title="All 2 branches covered.">      if (cmd.hasOption(&quot;digest&quot;)) {</span>
<span class="fc" id="L178">        final String digest = cmd.getOptionValue(&quot;digest&quot;);</span>
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if (&quot;crc&quot;.equalsIgnoreCase(digest)) {</span>
<span class="nc" id="L180">          ftpArgs.setDigest(DigestAlgo.CRC32);</span>
<span class="nc" id="L181">          ftpArgs.setDigestCommand(&quot;XCRC &quot; + ftpArgs.getFilename());</span>
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">        } else if (&quot;md5&quot;.equalsIgnoreCase(digest)) {</span>
<span class="nc" id="L183">          ftpArgs.setDigest(DigestAlgo.MD5);</span>
<span class="nc" id="L184">          ftpArgs.setDigestCommand(&quot;XMD5 &quot; + ftpArgs.getFilename());</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">        } else if (&quot;sha1&quot;.equalsIgnoreCase(digest)) {</span>
<span class="nc" id="L186">          ftpArgs.setDigest(DigestAlgo.SHA1);</span>
<span class="nc" id="L187">          ftpArgs.setDigestCommand(&quot;XSHA1 &quot; + ftpArgs.getFilename());</span>
<span class="fc bfc" id="L188" title="All 2 branches covered.">        } else if (&quot;sha256&quot;.equalsIgnoreCase(digest)) {</span>
<span class="fc" id="L189">          ftpArgs.setDigest(DigestAlgo.SHA256);</span>
<span class="fc" id="L190">          ftpArgs.setDigestCommand(&quot;XSHA256 &quot; + ftpArgs.getFilename());</span>
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">        } else if (&quot;sha384&quot;.equalsIgnoreCase(digest)) {</span>
<span class="nc" id="L192">          ftpArgs.setDigest(DigestAlgo.SHA384);</span>
<span class="nc" id="L193">          ftpArgs.setDigestCommand(&quot;XSHA384 &quot; + ftpArgs.getFilename());</span>
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">        } else if (&quot;sha512&quot;.equalsIgnoreCase(digest)) {</span>
<span class="fc" id="L195">          ftpArgs.setDigest(DigestAlgo.SHA512);</span>
<span class="fc" id="L196">          ftpArgs.setDigestCommand(&quot;XSHA512 &quot; + ftpArgs.getFilename());</span>
        } else {
<span class="nc" id="L198">          ftpArgs.setDigest(null);</span>
        }
      }
<span class="fc bfc" id="L201" title="All 2 branches covered.">      if (cmd.hasOption(&quot;pre&quot;)) {</span>
<span class="fc" id="L202">        ftpArgs.setPreArgs(cmd.getOptionValue(&quot;pre&quot;).replace(',', ' '));</span>
      }
<span class="fc bfc" id="L204" title="All 2 branches covered.">      if (cmd.hasOption(&quot;post&quot;)) {</span>
<span class="fc" id="L205">        ftpArgs.setPostArgs(cmd.getOptionValue(&quot;post&quot;).replace(',', ' '));</span>
      }
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">      if (cmd.hasOption(&quot;command&quot;)) {</span>
<span class="fc" id="L208">        ftpArgs.setCommand(cmd.getOptionValue(&quot;command&quot;));</span>
        // get,put,append,list
        // -1 get, 1 put, 2 append
<span class="fc bfc" id="L211" title="All 2 branches covered.">        if (&quot;get&quot;.equalsIgnoreCase(ftpArgs.getCommand())) {</span>
<span class="fc" id="L212">          ftpArgs.setCodeCommand(-1);</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">        } else if (&quot;put&quot;.equalsIgnoreCase(ftpArgs.getCommand())) {</span>
<span class="fc" id="L214">          ftpArgs.setCodeCommand(1);</span>
<span class="fc bfc" id="L215" title="All 2 branches covered.">        } else if (&quot;append&quot;.equalsIgnoreCase(ftpArgs.getCommand())) {</span>
<span class="fc" id="L216">          ftpArgs.setCodeCommand(2);</span>
        } else {
          // error
<span class="fc" id="L219">          ftpArgs.setCodeCommand(0);</span>
<span class="fc" id="L220">          throw new OpenR66RunnerErrorException(</span>
<span class="fc" id="L221">              &quot;Command not known: &quot; + ftpArgs.getCommand());</span>
        }
      }
<span class="fc" id="L224">    } catch (final ParseException e) {</span>
<span class="fc" id="L225">      throw new OpenR66RunnerErrorException(e);</span>
<span class="fc" id="L226">    }</span>

<span class="fc" id="L228">    return ftpArgs;</span>
  }

  public final String getFilepath() {
<span class="fc" id="L232">    return filepath;</span>
  }

  public final FtpArgs setFilepath(final String filepath) {
<span class="fc" id="L236">    this.filepath = filepath;</span>
<span class="fc" id="L237">    return this;</span>
  }

  public final String getFilename() {
<span class="fc" id="L241">    return filename;</span>
  }

  public final FtpArgs setFilename(final String filename) {
<span class="fc" id="L245">    this.filename = filename;</span>
<span class="fc" id="L246">    return this;</span>
  }

  public final String getRequested() {
<span class="fc" id="L250">    return requested;</span>
  }

  public final FtpArgs setRequested(final String requested) {
<span class="fc" id="L254">    this.requested = requested;</span>
<span class="fc" id="L255">    return this;</span>
  }

  public final int getPort() {
<span class="fc" id="L259">    return port;</span>
  }

  public final FtpArgs setPort(final int port) {
<span class="fc" id="L263">    this.port = port;</span>
<span class="fc" id="L264">    return this;</span>
  }

  public final String getUser() {
<span class="fc" id="L268">    return user;</span>
  }

  public final FtpArgs setUser(final String user) {
<span class="fc" id="L272">    this.user = user;</span>
<span class="fc" id="L273">    return this;</span>
  }

  public final String getPwd() {
<span class="fc" id="L277">    return pwd;</span>
  }

  public final FtpArgs setPwd(final String pwd) {
<span class="fc" id="L281">    this.pwd = pwd;</span>
<span class="fc" id="L282">    return this;</span>
  }

  public final String getAcct() {
<span class="fc" id="L286">    return acct;</span>
  }

  public final FtpArgs setAcct(final String acct) {
<span class="fc" id="L290">    this.acct = acct;</span>
<span class="fc" id="L291">    return this;</span>
  }

  public final boolean isPassive() {
<span class="fc" id="L295">    return isPassive;</span>
  }

  public final FtpArgs setPassive(final boolean passive) {
<span class="fc" id="L299">    isPassive = passive;</span>
<span class="fc" id="L300">    return this;</span>
  }

  public final int getSsl() {
<span class="fc" id="L304">    return ssl;</span>
  }

  public final FtpArgs setSsl(final int ssl) {
<span class="fc" id="L308">    this.ssl = ssl;</span>
<span class="fc" id="L309">    return this;</span>
  }

  public final String getCwd() {
<span class="fc" id="L313">    return cwd;</span>
  }

  public final FtpArgs setCwd(final String cwd) {
<span class="fc" id="L317">    this.cwd = cwd;</span>
<span class="fc" id="L318">    return this;</span>
  }

  public final DigestAlgo getDigest() {
<span class="fc" id="L322">    return digest;</span>
  }

  public final FtpArgs setDigest(final DigestAlgo digest) {
<span class="fc" id="L326">    this.digest = digest;</span>
<span class="fc" id="L327">    return this;</span>
  }

  public final String getDigestCommand() {
<span class="nc" id="L331">    return digestCommand;</span>
  }

  public final FtpArgs setDigestCommand(final String digestCommand) {
<span class="fc" id="L335">    this.digestCommand = digestCommand;</span>
<span class="fc" id="L336">    return this;</span>
  }

  public final String getCommand() {
<span class="fc" id="L340">    return command;</span>
  }

  public final FtpArgs setCommand(final String command) {
<span class="fc" id="L344">    this.command = command;</span>
<span class="fc" id="L345">    return this;</span>
  }

  public final int getCodeCommand() {
<span class="fc" id="L349">    return codeCommand;</span>
  }

  public final FtpArgs setCodeCommand(final int codeCommand) {
<span class="fc" id="L353">    this.codeCommand = codeCommand;</span>
<span class="fc" id="L354">    return this;</span>
  }

  public final String getPreArgs() {
<span class="fc" id="L358">    return preArgs;</span>
  }

  public final FtpArgs setPreArgs(final String preArgs) {
<span class="fc" id="L362">    this.preArgs = preArgs;</span>
<span class="fc" id="L363">    return this;</span>
  }

  public final String getPostArgs() {
<span class="fc" id="L367">    return postArgs;</span>
  }

  public final FtpArgs setPostArgs(final String postArgs) {
<span class="fc" id="L371">    this.postArgs = postArgs;</span>
<span class="fc" id="L372">    return this;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>