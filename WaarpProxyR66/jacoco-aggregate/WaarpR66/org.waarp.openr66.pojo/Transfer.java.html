<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Transfer.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Waarp Proxy in R66 protocol</a> &gt; <a href="../index.html" class="el_bundle">WaarpR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.pojo</a> &gt; <span class="el_source">Transfer.java</span></div><h1>Transfer.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package org.waarp.openr66.pojo;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonValue;
import org.waarp.common.database.exception.WaarpDatabaseSqlException;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.openr66.context.ErrorCode;
import org.waarp.openr66.database.DbConstantR66;
import org.waarp.openr66.database.data.DbTaskRunner;
import org.waarp.openr66.protocol.configuration.Configuration;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlTransient;
import javax.xml.bind.annotation.XmlType;
import java.sql.Timestamp;
import java.sql.Types;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import static org.waarp.common.database.data.AbstractDbData.*;
import static org.waarp.openr66.dao.database.DBTransferDAO.*;

/**
 * Transfer data object
 */
@XmlType(name = DbTaskRunner.XMLRUNNER)
@XmlAccessorType(XmlAccessType.NONE)
public class Transfer {
  /**
   * Internal Logger
   */
<span class="fc" id="L57">  private static final WaarpLogger logger =</span>
<span class="fc" id="L58">      WaarpLoggerFactory.getLogger(Transfer.class);</span>

<span class="fc" id="L60">  public enum TASKSTEP {</span>
<span class="fc" id="L61">    NOTASK(0), PRETASK(1), TRANSFERTASK(2), POSTTASK(3), ALLDONETASK(4),</span>
<span class="fc" id="L62">    ERRORTASK(5);</span>

    private final int taskNo;

<span class="fc" id="L66">    private static final Map&lt;Integer, TASKSTEP&gt; map =</span>
        new HashMap&lt;Integer, TASKSTEP&gt;();

    static {
<span class="fc bfc" id="L70" title="All 2 branches covered.">      for (final TASKSTEP task : TASKSTEP.values()) {</span>
<span class="fc" id="L71">        map.put(task.taskNo, task);</span>
      }
<span class="fc" id="L73">    }</span>

<span class="fc" id="L75">    TASKSTEP(final int task) {</span>
<span class="fc" id="L76">      taskNo = task;</span>
<span class="fc" id="L77">    }</span>

    public static TASKSTEP valueOf(final int taskStep) {
<span class="fc" id="L80">      return map.get(taskStep);</span>
    }

    public final DbTaskRunner.TASKSTEP toLegacy() {
<span class="fc" id="L84">      return DbTaskRunner.TASKSTEP.valueOf(name());</span>
    }

    @JsonValue
    public final int getTaskNo() {
<span class="fc" id="L89">      return taskNo;</span>
    }
  }

<span class="fc" id="L93">  @XmlElement(name = ID_FIELD)</span>
  @JsonProperty(&quot;SPECIALID&quot;)
  private long id = DbConstantR66.ILLEGALVALUE;

  /**
   * True if requester is the sender of the file (SEND MODE) False if
   * requested is the sender of the file
   * (RETRIEVE MODE)
   */
  @XmlElement(name = RETRIEVE_MODE_FIELD)
  @JsonProperty(&quot;RETRIEVEMODE&quot;)
  private boolean retrieveMode;

<span class="fc" id="L106">  @XmlElement(name = ID_RULE_FIELD)</span>
  @JsonProperty(&quot;IDRULE&quot;)
  private String rule = &quot;&quot;;

<span class="fc" id="L110">  @XmlElement(name = TRANSFER_MODE_FIELD)</span>
  @JsonProperty(&quot;MODETRANS&quot;)
  private int transferMode = 1;

<span class="fc" id="L114">  @XmlElement(name = FILENAME_FIELD)</span>
  @JsonProperty(&quot;FILENAME&quot;)
  private String filename = &quot;&quot;;

<span class="fc" id="L118">  @XmlElement(name = ORIGINAL_NAME_FIELD)</span>
  @JsonProperty(&quot;ORIGINALNAME&quot;)
  private String originalName = &quot;&quot;;

<span class="fc" id="L122">  @XmlElement(name = FILE_INFO_FIELD)</span>
  @JsonProperty(&quot;FILEINFO&quot;)
  private String fileInfo = &quot;&quot;;

  @XmlElement(name = IS_MOVED_FIELD)
  @JsonProperty(&quot;ISMOVED&quot;)
  private boolean isMoved;

  @XmlElement(name = BLOCK_SIZE_FIELD)
  @JsonProperty(&quot;BLOCKSZ&quot;)
  private int blockSize;

<span class="fc" id="L134">  @XmlElement(name = OWNER_REQUEST_FIELD)</span>
  @JsonProperty(&quot;OWNERREQ&quot;)
<span class="fc" id="L136">  private String ownerRequest = Configuration.configuration.getHostId();</span>

<span class="fc" id="L138">  @XmlElement(name = REQUESTER_FIELD)</span>
  @JsonProperty(&quot;REQUESTER&quot;)
  private String requester = &quot;&quot;;

<span class="fc" id="L142">  @XmlElement(name = REQUESTED_FIELD)</span>
  @JsonProperty(&quot;REQUESTED&quot;)
  private String requested = &quot;&quot;;

<span class="fc" id="L146">  @XmlElement(name = TRANSFER_INFO_FIELD)</span>
  @JsonProperty(&quot;TRANSFERINFO&quot;)
  private String transferInfo = &quot;&quot;;

<span class="fc" id="L150">  @XmlElement(name = GLOBAL_STEP_FIELD)</span>
  @JsonProperty(&quot;GLOBALSTEP&quot;)
  private TASKSTEP globalStep = TASKSTEP.NOTASK;

<span class="fc" id="L154">  @XmlElement(name = GLOBAL_LAST_STEP_FIELD)</span>
  @JsonProperty(&quot;GLOBALLASTSTEP&quot;)
  private TASKSTEP lastGlobalStep = TASKSTEP.NOTASK;

<span class="fc" id="L158">  @XmlElement(name = STEP_FIELD)</span>
  @JsonProperty(&quot;STEP&quot;)
  private int step = -1;

<span class="fc" id="L162">  @XmlElement(name = STEP_STATUS_FIELD)</span>
  @JsonProperty(&quot;STEPSTATUS&quot;)
  private ErrorCode stepStatus = ErrorCode.Unknown;

<span class="fc" id="L166">  @XmlElement(name = INFO_STATUS_FIELD)</span>
  @JsonProperty(&quot;INFOSTATUS&quot;)
  private ErrorCode infoStatus = ErrorCode.Unknown;

  @XmlElement(name = RANK_FIELD)
  @JsonProperty(&quot;RANK&quot;)
  private int rank;

<span class="fc" id="L174">  @XmlTransient</span>
  @JsonProperty(&quot;STARTTRANS&quot;)
  private Timestamp start = new Timestamp(0);

<span class="fc" id="L178">  @XmlTransient</span>
  @JsonProperty(&quot;STOPTRANS&quot;)
  private Timestamp stop = new Timestamp(0);

<span class="fc" id="L182">  @XmlTransient</span>
  @JsonProperty(&quot;UPDATEDINFO&quot;)
  private UpdatedInfo updatedInfo = UpdatedInfo.UNKNOWN;

  @XmlElement(name = TRANSFER_START_FIELD)
  @JsonIgnore
  public final long getXmlStart() {
<span class="nc" id="L189">    return start.getTime();</span>
  }

  public final void setXmlStart(final long xml) {
<span class="nc" id="L193">    start = new Timestamp(xml);</span>
<span class="nc" id="L194">  }</span>

  @XmlElement(name = TRANSFER_STOP_FIELD)
  @JsonIgnore
  public final long getXmlStop() {
<span class="nc" id="L199">    return stop.getTime();</span>
  }

  public final void setXmlStop(final long xml) {
<span class="nc" id="L203">    stop = new Timestamp(xml);</span>
<span class="nc" id="L204">  }</span>

  /**
   * Full Constructor to create Transfer from the database
   *
   * @param id
   * @param rule
   * @param mode
   * @param filename
   * @param originalName
   * @param fileInfo
   * @param isMoved
   * @param blockSize
   * @param retrieveMode
   * @param ownerReq
   * @param requester
   * @param requested
   * @param transferInfo
   * @param globalStep
   * @param lastGlobalStep
   * @param step
   * @param stepStatus
   * @param infoStatus
   * @param rank
   * @param start
   * @param stop
   * @param updatedInfo
   */
  public Transfer(final long id, final String rule, final int mode,
                  final String filename, final String originalName,
                  final String fileInfo, final boolean isMoved,
                  final int blockSize, final boolean retrieveMode,
                  final String ownerReq, final String requester,
                  final String requested, final String transferInfo,
                  final TASKSTEP globalStep, final TASKSTEP lastGlobalStep,
                  final int step, final ErrorCode stepStatus,
                  final ErrorCode infoStatus, final int rank,
                  final Timestamp start, final Timestamp stop,
                  final UpdatedInfo updatedInfo)
      throws WaarpDatabaseSqlException {
<span class="fc" id="L244">    this(id, rule, mode, filename, originalName, fileInfo, isMoved, blockSize,</span>
         retrieveMode, ownerReq, requester, requested, transferInfo, globalStep,
         lastGlobalStep, step, stepStatus, infoStatus, rank, start, stop);
<span class="fc" id="L247">    this.updatedInfo = updatedInfo;</span>
<span class="fc" id="L248">  }</span>

  /**
   * Constructor to create Transfer from remote requests
   *
   * @param id
   * @param rule
   * @param mode
   * @param filename
   * @param originalName
   * @param fileInfo
   * @param isMoved
   * @param blockSize
   * @param retrieveMode
   * @param ownerReq
   * @param requester
   * @param requested
   * @param transferInfo
   * @param globalStep
   * @param lastGlobalStep
   * @param step
   * @param stepStatus
   * @param infoStatus
   * @param rank
   * @param start
   * @param stop
   */
  public Transfer(final long id, final String rule, final int mode,
                  final String filename, final String originalName,
                  final String fileInfo, final boolean isMoved,
                  final int blockSize, final boolean retrieveMode,
                  final String ownerReq, final String requester,
                  final String requested, final String transferInfo,
                  final TASKSTEP globalStep, final TASKSTEP lastGlobalStep,
                  final int step, final ErrorCode stepStatus,
                  final ErrorCode infoStatus, final int rank,
                  final Timestamp start, final Timestamp stop)
<span class="fc" id="L285">      throws WaarpDatabaseSqlException {</span>
<span class="fc" id="L286">    this.id = id;</span>
<span class="fc" id="L287">    this.rule = rule;</span>
<span class="fc" id="L288">    transferMode = mode;</span>
<span class="fc" id="L289">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L290">    this.filename = filename;</span>
<span class="fc" id="L291">    this.originalName = originalName;</span>
<span class="fc" id="L292">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L293">    this.isMoved = isMoved;</span>
<span class="fc" id="L294">    this.blockSize = blockSize;</span>
<span class="fc" id="L295">    ownerRequest = ownerReq;</span>
<span class="fc" id="L296">    this.requester = requester;</span>
<span class="fc" id="L297">    this.requested = requested;</span>
<span class="fc" id="L298">    this.transferInfo = transferInfo;</span>
<span class="fc" id="L299">    this.globalStep = globalStep;</span>
<span class="fc" id="L300">    this.lastGlobalStep = lastGlobalStep;</span>
<span class="fc" id="L301">    this.step = step;</span>
<span class="fc" id="L302">    this.stepStatus = stepStatus;</span>
<span class="fc" id="L303">    this.infoStatus = infoStatus;</span>
<span class="fc" id="L304">    this.rank = rank;</span>
<span class="fc" id="L305">    this.start = start;</span>
<span class="fc" id="L306">    this.stop = stop;</span>
<span class="fc" id="L307">    checkValues();</span>
<span class="fc" id="L308">  }</span>

  /**
   * Constructor to create transfer locally with delayed start time
   *
   * @param rule
   * @param retrieveMode
   * @param file
   * @param fileInfo
   * @param blockSize
   */
  public Transfer(final String remote, final String rule, final int ruleMode,
                  final boolean retrieveMode, final String file,
                  final String fileInfo, final int blockSize,
<span class="fc" id="L322">                  final Timestamp start) throws WaarpDatabaseSqlException {</span>
<span class="fc" id="L323">    ownerRequest = Configuration.configuration.getHostId();</span>
<span class="fc" id="L324">    requester = Configuration.configuration.getHostId();</span>
<span class="fc" id="L325">    requested = remote;</span>
<span class="fc" id="L326">    this.rule = rule;</span>
<span class="fc" id="L327">    transferMode = ruleMode;</span>
<span class="fc" id="L328">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L329">    filename = file;</span>
<span class="fc" id="L330">    originalName = file;</span>
<span class="fc" id="L331">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L332">    this.blockSize = blockSize;</span>
<span class="fc" id="L333">    this.start = start;</span>
<span class="fc" id="L334">    checkValues();</span>
<span class="fc" id="L335">  }</span>

  /**
   * Constructor to create transfer locally
   *
   * @param rule
   * @param retrieveMode
   * @param file
   * @param fileInfo
   * @param blockSize
   */
  public Transfer(final String remote, final String rule, final int ruleMode,
                  final boolean retrieveMode, final String file,
                  final String fileInfo, final int blockSize)
      throws WaarpDatabaseSqlException {
<span class="fc" id="L350">    this(remote, rule, ruleMode, retrieveMode, file, fileInfo, blockSize,</span>
<span class="fc" id="L351">         new Timestamp(new Date().getTime()));</span>
<span class="fc" id="L352">  }</span>

  /**
   * Empty constructor
   */
<span class="fc" id="L357">  public Transfer() {</span>
    // Nothing
<span class="fc" id="L359">  }</span>

  @JsonIgnore
  public final void checkValues() throws WaarpDatabaseSqlException {
<span class="fc" id="L363">    validateLength(Types.NVARCHAR, rule, ownerRequest, requested, requester);</span>
<span class="fc" id="L364">    validateLength(Types.VARCHAR, filename, originalName, fileInfo,</span>
                   transferInfo);
<span class="fc" id="L366">  }</span>

  public final long getId() {
<span class="fc" id="L369">    return id;</span>
  }

  public final void setId(final long id) {
<span class="fc" id="L373">    this.id = id;</span>
<span class="fc" id="L374">  }</span>

  public final boolean getRetrieveMode() {
<span class="fc" id="L377">    return retrieveMode;</span>
  }

  public final void setRetrieveMode(final boolean retrieveMode) {
<span class="fc" id="L381">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L382">  }</span>

  public final String getRule() {
<span class="fc" id="L385">    return rule;</span>
  }

  public final void setRule(final String rule) {
<span class="fc" id="L389">    this.rule = rule;</span>
<span class="fc" id="L390">  }</span>

  public final int getTransferMode() {
<span class="fc" id="L393">    return transferMode;</span>
  }

  public final void setTransferMode(final int mode) {
<span class="fc" id="L397">    transferMode = mode;</span>
<span class="fc" id="L398">  }</span>

  public final String getFilename() {
<span class="fc" id="L401">    return filename;</span>
  }

  public final void setFilename(final String filename) {
<span class="fc" id="L405">    this.filename = filename;</span>
<span class="fc" id="L406">  }</span>

  public final String getOriginalName() {
<span class="fc" id="L409">    return originalName;</span>
  }

  public final void setOriginalName(final String originalName) {
<span class="fc" id="L413">    this.originalName = originalName;</span>
<span class="fc" id="L414">  }</span>

  public final String getFileInfo() {
<span class="fc" id="L417">    return fileInfo;</span>
  }

  public final void setFileInfo(final String fileInfo) {
<span class="fc" id="L421">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L422">  }</span>

  public final boolean getIsMoved() {
<span class="fc" id="L425">    return isMoved;</span>
  }

  public final void setIsMoved(final boolean isMoved) {
<span class="fc" id="L429">    this.isMoved = isMoved;</span>
<span class="fc" id="L430">  }</span>

  public final int getBlockSize() {
<span class="fc" id="L433">    return blockSize;</span>
  }

  public final void setBlockSize(final int blockSize) {
<span class="fc" id="L437">    this.blockSize = blockSize;</span>
<span class="fc" id="L438">  }</span>

  public final String getOwnerRequest() {
<span class="fc" id="L441">    return ownerRequest;</span>
  }

  public final void setOwnerRequest(final String ownerRequest) {
<span class="fc" id="L445">    this.ownerRequest = ownerRequest;</span>
<span class="fc" id="L446">  }</span>

  public final String getRequester() {
<span class="fc" id="L449">    return requester;</span>
  }

  public final void setRequester(final String requester) {
<span class="fc" id="L453">    this.requester = requester;</span>
<span class="fc" id="L454">  }</span>

  public final String getRequested() {
<span class="fc" id="L457">    return requested;</span>
  }

  public final void setRequested(final String requested) {
<span class="fc" id="L461">    this.requested = requested;</span>
<span class="fc" id="L462">  }</span>

  public final String getTransferInfo() {
<span class="fc" id="L465">    return transferInfo;</span>
  }

  public final void setTransferInfo(final String transferInfo) {
<span class="fc" id="L469">    this.transferInfo = transferInfo;</span>
<span class="fc" id="L470">  }</span>

  public final TASKSTEP getGlobalStep() {
<span class="fc" id="L473">    return globalStep;</span>
  }

  public final void setGlobalStep(final TASKSTEP globalStep) {
<span class="fc" id="L477">    this.globalStep = globalStep;</span>
<span class="fc" id="L478">  }</span>

  public final TASKSTEP getLastGlobalStep() {
<span class="fc" id="L481">    return lastGlobalStep;</span>
  }

  public final void setLastGlobalStep(final TASKSTEP lastGlobalStep) {
<span class="fc" id="L485">    this.lastGlobalStep = lastGlobalStep;</span>
<span class="fc" id="L486">  }</span>

  public final int getStep() {
<span class="fc" id="L489">    return step;</span>
  }

  public final void setStep(final int step) {
<span class="fc" id="L493">    this.step = step;</span>
<span class="fc" id="L494">  }</span>

  public final ErrorCode getStepStatus() {
<span class="fc" id="L497">    return stepStatus;</span>
  }

  public final void setStepStatus(final ErrorCode stepStatus) {
<span class="fc" id="L501">    this.stepStatus = stepStatus;</span>
<span class="fc" id="L502">  }</span>

  public final ErrorCode getInfoStatus() {
<span class="fc" id="L505">    return infoStatus;</span>
  }

  public final void setInfoStatus(final ErrorCode infoStatus) {
<span class="fc" id="L509">    this.infoStatus = infoStatus;</span>
<span class="fc" id="L510">  }</span>

  public final int getRank() {
<span class="fc" id="L513">    return rank;</span>
  }

  public final void setRank(final int rank) {
<span class="fc" id="L517">    this.rank = rank;</span>
<span class="fc" id="L518">  }</span>

  public final Timestamp getStart() {
<span class="fc" id="L521">    return start;</span>
  }

  public final void setStart(final Timestamp start) {
<span class="fc" id="L525">    this.start = start;</span>
<span class="fc" id="L526">  }</span>

  public final Timestamp getStop() {
<span class="fc" id="L529">    return stop;</span>
  }

  public final void setStop(final Timestamp stop) {
<span class="fc" id="L533">    this.stop = stop;</span>
<span class="fc" id="L534">  }</span>

  public final UpdatedInfo getUpdatedInfo() {
<span class="fc" id="L537">    return updatedInfo;</span>
  }

  public final void setUpdatedInfo(final UpdatedInfo info) {
<span class="fc" id="L541">    updatedInfo = info;</span>
<span class="fc" id="L542">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>