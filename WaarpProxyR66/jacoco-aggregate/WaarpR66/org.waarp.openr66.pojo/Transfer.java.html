<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Transfer.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Waarp Proxy in R66 protocol</a> &gt; <a href="../index.html" class="el_bundle">WaarpR66</a> &gt; <a href="index.source.html" class="el_package">org.waarp.openr66.pojo</a> &gt; <span class="el_source">Transfer.java</span></div><h1>Transfer.java</h1><pre class="source lang-java linenums">/*
 * This file is part of Waarp Project (named also Waarp or GG).
 *
 *  Copyright (c) 2019, Waarp SAS, and individual contributors by the @author
 *  tags. See the COPYRIGHT.txt in the distribution for a full listing of
 * individual contributors.
 *
 *  All Waarp Project is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or (at your
 * option) any later version.
 *
 * Waarp is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along with
 * Waarp . If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package org.waarp.openr66.pojo;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonValue;
import org.waarp.common.logging.WaarpLogger;
import org.waarp.common.logging.WaarpLoggerFactory;
import org.waarp.openr66.context.ErrorCode;
import org.waarp.openr66.database.DbConstantR66;
import org.waarp.openr66.database.data.DbTaskRunner;
import org.waarp.openr66.protocol.configuration.Configuration;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlTransient;
import javax.xml.bind.annotation.XmlType;
import java.sql.Timestamp;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import static org.waarp.openr66.dao.database.DBTransferDAO.*;

/**
 * Transfer data object
 */
@XmlType(name = DbTaskRunner.XMLRUNNER)
@XmlAccessorType(XmlAccessType.NONE)
public class Transfer {
  /**
   * Internal Logger
   */
<span class="fc" id="L54">  private static final WaarpLogger logger =</span>
<span class="fc" id="L55">      WaarpLoggerFactory.getLogger(Transfer.class);</span>

<span class="fc" id="L57">  public enum TASKSTEP {</span>
<span class="fc" id="L58">    NOTASK(0), PRETASK(1), TRANSFERTASK(2), POSTTASK(3), ALLDONETASK(4),</span>
<span class="fc" id="L59">    ERRORTASK(5);</span>

    private final int taskNo;

<span class="fc" id="L63">    private static final Map&lt;Integer, TASKSTEP&gt; map =</span>
        new HashMap&lt;Integer, TASKSTEP&gt;();

    static {
<span class="fc bfc" id="L67" title="All 2 branches covered.">      for (final TASKSTEP task : TASKSTEP.values()) {</span>
<span class="fc" id="L68">        map.put(task.taskNo, task);</span>
      }
<span class="fc" id="L70">    }</span>

<span class="fc" id="L72">    TASKSTEP(final int task) {</span>
<span class="fc" id="L73">      taskNo = task;</span>
<span class="fc" id="L74">    }</span>

    public static TASKSTEP valueOf(final int taskStep) {
<span class="fc" id="L77">      return map.get(taskStep);</span>
    }

    public DbTaskRunner.TASKSTEP toLegacy() {
<span class="fc" id="L81">      return DbTaskRunner.TASKSTEP.valueOf(name());</span>
    }

    @JsonValue
    public int getTaskNo() {
<span class="fc" id="L86">      return taskNo;</span>
    }
  }

<span class="fc" id="L90">  @XmlElement(name = ID_FIELD)</span>
  @JsonProperty(&quot;SPECIALID&quot;)
  private long id = DbConstantR66.ILLEGALVALUE;

  /**
   * True if requester is the sender of the file (SEND MODE) False if
   * requested is the sender of the file
   * (RETRIEVE MODE)
   */
  @XmlElement(name = RETRIEVE_MODE_FIELD)
  @JsonProperty(&quot;RETRIEVEMODE&quot;)
  private boolean retrieveMode;

<span class="fc" id="L103">  @XmlElement(name = ID_RULE_FIELD)</span>
  @JsonProperty(&quot;IDRULE&quot;)
  private String rule = &quot;&quot;;

<span class="fc" id="L107">  @XmlElement(name = TRANSFER_MODE_FIELD)</span>
  @JsonProperty(&quot;MODETRANS&quot;)
  private int transferMode = 1;

<span class="fc" id="L111">  @XmlElement(name = FILENAME_FIELD)</span>
  @JsonProperty(&quot;FILENAME&quot;)
  private String filename = &quot;&quot;;

<span class="fc" id="L115">  @XmlElement(name = ORIGINAL_NAME_FIELD)</span>
  @JsonProperty(&quot;ORIGINALNAME&quot;)
  private String originalName = &quot;&quot;;

<span class="fc" id="L119">  @XmlElement(name = FILE_INFO_FIELD)</span>
  @JsonProperty(&quot;FILEINFO&quot;)
  private String fileInfo = &quot;&quot;;

  @XmlElement(name = IS_MOVED_FIELD)
  @JsonProperty(&quot;ISMOVED&quot;)
  private boolean isMoved;

  @XmlElement(name = BLOCK_SIZE_FIELD)
  @JsonProperty(&quot;BLOCKSZ&quot;)
  private int blockSize;

<span class="fc" id="L131">  @XmlElement(name = OWNER_REQUEST_FIELD)</span>
  @JsonProperty(&quot;OWNERREQ&quot;)
<span class="fc" id="L133">  private String ownerRequest = Configuration.configuration.getHostId();</span>

<span class="fc" id="L135">  @XmlElement(name = REQUESTER_FIELD)</span>
  @JsonProperty(&quot;REQUESTER&quot;)
  private String requester = &quot;&quot;;

<span class="fc" id="L139">  @XmlElement(name = REQUESTED_FIELD)</span>
  @JsonProperty(&quot;REQUESTED&quot;)
  private String requested = &quot;&quot;;

<span class="fc" id="L143">  @XmlElement(name = TRANSFER_INFO_FIELD)</span>
  @JsonProperty(&quot;TRANSFERINFO&quot;)
  private String transferInfo = &quot;&quot;;

<span class="fc" id="L147">  @XmlElement(name = GLOBAL_STEP_FIELD)</span>
  @JsonProperty(&quot;GLOBALSTEP&quot;)
  private TASKSTEP globalStep = TASKSTEP.NOTASK;

<span class="fc" id="L151">  @XmlElement(name = GLOBAL_LAST_STEP_FIELD)</span>
  @JsonProperty(&quot;GLOBALLASTSTEP&quot;)
  private TASKSTEP lastGlobalStep = TASKSTEP.NOTASK;

<span class="fc" id="L155">  @XmlElement(name = STEP_FIELD)</span>
  @JsonProperty(&quot;STEP&quot;)
  private int step = -1;

<span class="fc" id="L159">  @XmlElement(name = STEP_STATUS_FIELD)</span>
  @JsonProperty(&quot;STEPSTATUS&quot;)
  private ErrorCode stepStatus = ErrorCode.Unknown;

<span class="fc" id="L163">  @XmlElement(name = INFO_STATUS_FIELD)</span>
  @JsonProperty(&quot;INFOSTATUS&quot;)
  private ErrorCode infoStatus = ErrorCode.Unknown;

  @XmlElement(name = RANK_FIELD)
  @JsonProperty(&quot;RANK&quot;)
  private int rank;

<span class="fc" id="L171">  @XmlTransient</span>
  @JsonProperty(&quot;STARTTRANS&quot;)
  private Timestamp start = new Timestamp(0);

<span class="fc" id="L175">  @XmlTransient</span>
  @JsonProperty(&quot;STOPTRANS&quot;)
  private Timestamp stop = new Timestamp(0);

<span class="fc" id="L179">  @XmlTransient</span>
  @JsonProperty(&quot;UPDATEDINFO&quot;)
  private UpdatedInfo updatedInfo = UpdatedInfo.UNKNOWN;

  @XmlElement(name = TRANSFER_START_FIELD)
  @JsonIgnore
  public long getXmlStart() {
<span class="nc" id="L186">    return start.getTime();</span>
  }

  public void setXmlStart(final long xml) {
<span class="nc" id="L190">    start = new Timestamp(xml);</span>
<span class="nc" id="L191">  }</span>

  @XmlElement(name = TRANSFER_STOP_FIELD)
  @JsonIgnore
  public long getXmlStop() {
<span class="nc" id="L196">    return stop.getTime();</span>
  }

  public void setXmlStop(final long xml) {
<span class="nc" id="L200">    stop = new Timestamp(xml);</span>
<span class="nc" id="L201">  }</span>

  /**
   * Full Constructor to create Transfer from the database
   *
   * @param id
   * @param rule
   * @param mode
   * @param filename
   * @param originalName
   * @param fileInfo
   * @param isMoved
   * @param blockSize
   * @param retrieveMode
   * @param ownerReq
   * @param requester
   * @param requested
   * @param transferInfo
   * @param globalStep
   * @param lastGlobalStep
   * @param step
   * @param stepStatus
   * @param infoStatus
   * @param rank
   * @param start
   * @param stop
   * @param updatedInfo
   */
  public Transfer(final long id, final String rule, final int mode,
                  final String filename, final String originalName,
                  final String fileInfo, final boolean isMoved,
                  final int blockSize, final boolean retrieveMode,
                  final String ownerReq, final String requester,
                  final String requested, final String transferInfo,
                  final TASKSTEP globalStep, final TASKSTEP lastGlobalStep,
                  final int step, final ErrorCode stepStatus,
                  final ErrorCode infoStatus, final int rank,
                  final Timestamp start, final Timestamp stop,
                  final UpdatedInfo updatedInfo) {
<span class="fc" id="L240">    this(id, rule, mode, filename, originalName, fileInfo, isMoved, blockSize,</span>
         retrieveMode, ownerReq, requester, requested, transferInfo, globalStep,
         lastGlobalStep, step, stepStatus, infoStatus, rank, start, stop);
<span class="fc" id="L243">    this.updatedInfo = updatedInfo;</span>
<span class="fc" id="L244">  }</span>

  /**
   * Constructor to create Transfer from remote requests
   *
   * @param id
   * @param rule
   * @param mode
   * @param filename
   * @param originalName
   * @param fileInfo
   * @param isMoved
   * @param blockSize
   * @param retrieveMode
   * @param ownerReq
   * @param requester
   * @param requested
   * @param transferInfo
   * @param globalStep
   * @param lastGlobalStep
   * @param step
   * @param stepStatus
   * @param infoStatus
   * @param rank
   * @param start
   * @param stop
   */
  public Transfer(final long id, final String rule, final int mode,
                  final String filename, final String originalName,
                  final String fileInfo, final boolean isMoved,
                  final int blockSize, final boolean retrieveMode,
                  final String ownerReq, final String requester,
                  final String requested, final String transferInfo,
                  final TASKSTEP globalStep, final TASKSTEP lastGlobalStep,
                  final int step, final ErrorCode stepStatus,
                  final ErrorCode infoStatus, final int rank,
<span class="fc" id="L280">                  final Timestamp start, final Timestamp stop) {</span>
<span class="fc" id="L281">    this.id = id;</span>
<span class="fc" id="L282">    this.rule = rule;</span>
<span class="fc" id="L283">    transferMode = mode;</span>
<span class="fc" id="L284">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L285">    this.filename = filename;</span>
<span class="fc" id="L286">    this.originalName = originalName;</span>
<span class="fc" id="L287">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L288">    this.isMoved = isMoved;</span>
<span class="fc" id="L289">    this.blockSize = blockSize;</span>
<span class="fc" id="L290">    ownerRequest = ownerReq;</span>
<span class="fc" id="L291">    this.requester = requester;</span>
<span class="fc" id="L292">    this.requested = requested;</span>
<span class="fc" id="L293">    this.transferInfo = transferInfo;</span>
<span class="fc" id="L294">    this.globalStep = globalStep;</span>
<span class="fc" id="L295">    this.lastGlobalStep = lastGlobalStep;</span>
<span class="fc" id="L296">    this.step = step;</span>
<span class="fc" id="L297">    this.stepStatus = stepStatus;</span>
<span class="fc" id="L298">    this.infoStatus = infoStatus;</span>
<span class="fc" id="L299">    this.rank = rank;</span>
<span class="fc" id="L300">    this.start = start;</span>
<span class="fc" id="L301">    this.stop = stop;</span>
<span class="fc" id="L302">  }</span>

  /**
   * Constructor to create transfer locally with delayed start time
   *
   * @param rule
   * @param retrieveMode
   * @param file
   * @param fileInfo
   * @param blockSize
   */
  public Transfer(final String remote, final String rule, final int ruleMode,
                  final boolean retrieveMode, final String file,
                  final String fileInfo, final int blockSize,
<span class="fc" id="L316">                  final Timestamp start) {</span>
<span class="fc" id="L317">    ownerRequest = Configuration.configuration.getHostId();</span>
<span class="fc" id="L318">    requester = Configuration.configuration.getHostId();</span>
<span class="fc" id="L319">    requested = remote;</span>
<span class="fc" id="L320">    this.rule = rule;</span>
<span class="fc" id="L321">    transferMode = ruleMode;</span>
<span class="fc" id="L322">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L323">    filename = file;</span>
<span class="fc" id="L324">    originalName = file;</span>
<span class="fc" id="L325">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L326">    this.blockSize = blockSize;</span>
<span class="fc" id="L327">    this.start = start;</span>
<span class="fc" id="L328">  }</span>

  /**
   * Constructor to create transfer locally
   *
   * @param rule
   * @param retrieveMode
   * @param file
   * @param fileInfo
   * @param blockSize
   */
  public Transfer(final String remote, final String rule, final int ruleMode,
                  final boolean retrieveMode, final String file,
                  final String fileInfo, final int blockSize) {
<span class="fc" id="L342">    this(remote, rule, ruleMode, retrieveMode, file, fileInfo, blockSize,</span>
<span class="fc" id="L343">         new Timestamp(new Date().getTime()));</span>
<span class="fc" id="L344">  }</span>

  /**
   * Empty constructor
   */
<span class="fc" id="L349">  public Transfer() {</span>
    // Nothing
<span class="fc" id="L351">  }</span>

  public long getId() {
<span class="fc" id="L354">    return id;</span>
  }

  public void setId(final long id) {
<span class="fc" id="L358">    this.id = id;</span>
<span class="fc" id="L359">  }</span>

  public boolean getRetrieveMode() {
<span class="fc" id="L362">    return retrieveMode;</span>
  }

  public void setRetrieveMode(final boolean retrieveMode) {
<span class="fc" id="L366">    this.retrieveMode = retrieveMode;</span>
<span class="fc" id="L367">  }</span>

  public String getRule() {
<span class="fc" id="L370">    return rule;</span>
  }

  public void setRule(final String rule) {
<span class="fc" id="L374">    this.rule = rule;</span>
<span class="fc" id="L375">  }</span>

  public int getTransferMode() {
<span class="fc" id="L378">    return transferMode;</span>
  }

  public void setTransferMode(final int mode) {
<span class="fc" id="L382">    transferMode = mode;</span>
<span class="fc" id="L383">  }</span>

  public String getFilename() {
<span class="fc" id="L386">    return filename;</span>
  }

  public void setFilename(final String filename) {
<span class="fc" id="L390">    this.filename = filename;</span>
<span class="fc" id="L391">  }</span>

  public String getOriginalName() {
<span class="fc" id="L394">    return originalName;</span>
  }

  public void setOriginalName(final String originalName) {
<span class="fc" id="L398">    this.originalName = originalName;</span>
<span class="fc" id="L399">  }</span>

  public String getFileInfo() {
<span class="fc" id="L402">    return fileInfo;</span>
  }

  public void setFileInfo(final String fileInfo) {
<span class="fc" id="L406">    this.fileInfo = fileInfo;</span>
<span class="fc" id="L407">  }</span>

  public boolean getIsMoved() {
<span class="fc" id="L410">    return isMoved;</span>
  }

  public void setIsMoved(final boolean isMoved) {
<span class="fc" id="L414">    this.isMoved = isMoved;</span>
<span class="fc" id="L415">  }</span>

  public int getBlockSize() {
<span class="fc" id="L418">    return blockSize;</span>
  }

  public void setBlockSize(final int blockSize) {
<span class="fc" id="L422">    this.blockSize = blockSize;</span>
<span class="fc" id="L423">  }</span>

  public String getOwnerRequest() {
<span class="fc" id="L426">    return ownerRequest;</span>
  }

  public void setOwnerRequest(final String ownerRequest) {
<span class="fc" id="L430">    this.ownerRequest = ownerRequest;</span>
<span class="fc" id="L431">  }</span>

  public String getRequester() {
<span class="fc" id="L434">    return requester;</span>
  }

  public void setRequester(final String requester) {
<span class="fc" id="L438">    this.requester = requester;</span>
<span class="fc" id="L439">  }</span>

  public String getRequested() {
<span class="fc" id="L442">    return requested;</span>
  }

  public void setRequested(final String requested) {
<span class="fc" id="L446">    this.requested = requested;</span>
<span class="fc" id="L447">  }</span>

  public String getTransferInfo() {
<span class="fc" id="L450">    return transferInfo;</span>
  }

  public void setTransferInfo(final String transferInfo) {
<span class="fc" id="L454">    this.transferInfo = transferInfo;</span>
<span class="fc" id="L455">  }</span>

  public TASKSTEP getGlobalStep() {
<span class="fc" id="L458">    return globalStep;</span>
  }

  public void setGlobalStep(final TASKSTEP globalStep) {
<span class="fc" id="L462">    this.globalStep = globalStep;</span>
<span class="fc" id="L463">  }</span>

  public TASKSTEP getLastGlobalStep() {
<span class="fc" id="L466">    return lastGlobalStep;</span>
  }

  public void setLastGlobalStep(final TASKSTEP lastGlobalStep) {
<span class="fc" id="L470">    this.lastGlobalStep = lastGlobalStep;</span>
<span class="fc" id="L471">  }</span>

  public int getStep() {
<span class="fc" id="L474">    return step;</span>
  }

  public void setStep(final int step) {
<span class="fc" id="L478">    this.step = step;</span>
<span class="fc" id="L479">  }</span>

  public ErrorCode getStepStatus() {
<span class="fc" id="L482">    return stepStatus;</span>
  }

  public void setStepStatus(final ErrorCode stepStatus) {
<span class="fc" id="L486">    this.stepStatus = stepStatus;</span>
<span class="fc" id="L487">  }</span>

  public ErrorCode getInfoStatus() {
<span class="fc" id="L490">    return infoStatus;</span>
  }

  public void setInfoStatus(final ErrorCode infoStatus) {
<span class="fc" id="L494">    this.infoStatus = infoStatus;</span>
<span class="fc" id="L495">  }</span>

  public int getRank() {
<span class="fc" id="L498">    return rank;</span>
  }

  public void setRank(final int rank) {
<span class="fc" id="L502">    this.rank = rank;</span>
<span class="fc" id="L503">  }</span>

  public Timestamp getStart() {
<span class="fc" id="L506">    return start;</span>
  }

  public void setStart(final Timestamp start) {
<span class="fc" id="L510">    this.start = start;</span>
<span class="fc" id="L511">  }</span>

  public Timestamp getStop() {
<span class="fc" id="L514">    return stop;</span>
  }

  public void setStop(final Timestamp stop) {
<span class="fc" id="L518">    this.stop = stop;</span>
<span class="fc" id="L519">  }</span>

  public UpdatedInfo getUpdatedInfo() {
<span class="fc" id="L522">    return updatedInfo;</span>
  }

  public void setUpdatedInfo(final UpdatedInfo info) {
<span class="fc" id="L526">    updatedInfo = info;</span>
<span class="fc" id="L527">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>