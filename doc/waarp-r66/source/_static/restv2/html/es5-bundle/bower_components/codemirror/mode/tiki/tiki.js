// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE
(function(mod){if("object"==("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"==("undefined"===typeof module?"undefined":babelHelpers.typeof(module)))// CommonJS
mod(require("../../lib/codemirror"));else if("function"==typeof define&&define.amd)// AMD
define(["../../lib/codemirror"],mod);else// Plain browser env
mod(CodeMirror)})(function(CodeMirror){"use strict";CodeMirror.defineMode("tiki",function(config){function inBlock(style,terminator,returnTokenizer){return function(stream,state){while(!stream.eol()){if(stream.match(terminator)){state.tokenize=inText;break}stream.next()}if(returnTokenizer)state.tokenize=returnTokenizer;return style}}function inLine(style){return function(stream,state){while(!stream.eol()){stream.next()}state.tokenize=inText;return style}}function inText(stream,state){function chain(parser){state.tokenize=parser;return parser(stream,state)}var sol=stream.sol(),ch=stream.next();//non start of line
switch(ch){//switch is generally much faster than if, so it is used here
case"{"://plugin
stream.eat("/");stream.eatSpace();stream.eatWhile(/[^\s\u00a0=\"\'\/?(}]/);state.tokenize=inPlugin;return"tag";case"_"://bold
if(stream.eat("_"))return chain(inBlock("strong","__",inText));break;case"'"://italics
if(stream.eat("'"))return chain(inBlock("em","''",inText));break;case"(":// Wiki Link
if(stream.eat("("))return chain(inBlock("variable-2","))",inText));break;case"[":// Weblink
return chain(inBlock("variable-3","]",inText));break;case"|"://table
if(stream.eat("|"))return chain(inBlock("comment","||"));break;case"-":if(stream.eat("=")){//titleBar
return chain(inBlock("header string","=-",inText))}else if(stream.eat("-")){//deleted
return chain(inBlock("error tw-deleted","--",inText))}break;case"="://underline
if(stream.match("=="))return chain(inBlock("tw-underline","===",inText));break;case":":if(stream.eat(":"))return chain(inBlock("comment","::"));break;case"^"://box
return chain(inBlock("tw-box","^"));break;case"~"://np
if(stream.match("np~"))return chain(inBlock("meta","~/np~"));break;}//start of line types
if(sol){switch(ch){case"!"://header at start of line
if(stream.match("!!!!!")){return chain(inLine("header string"))}else if(stream.match("!!!!")){return chain(inLine("header string"))}else if(stream.match("!!!")){return chain(inLine("header string"))}else if(stream.match("!!")){return chain(inLine("header string"))}else{return chain(inLine("header string"))}break;case"*"://unordered list line item, or <li /> at start of line
case"#"://ordered list line item, or <li /> at start of line
case"+"://ordered list line item, or <li /> at start of line
return chain(inLine("tw-listitem bracket"));break;}}//stream.eatWhile(/[&{]/); was eating up plugins, turned off to act less like html and more like tiki
return null}var indentUnit=config.indentUnit,pluginName,type;// Return variables for tokenizers
function inPlugin(stream,state){var ch=stream.next(),peek=stream.peek();if("}"==ch){state.tokenize=inText;//type = ch == ")" ? "endPlugin" : "selfclosePlugin"; inPlugin
return"tag"}else if("("==ch||")"==ch){return"bracket"}else if("="==ch){type="equals";if(">"==peek){stream.next();peek=stream.peek()}//here we detect values directly after equal character with no quotes
if(!/[\'\"]/.test(peek)){state.tokenize=inAttributeNoQuote()}//end detect values
return"operator"}else if(/[\'\"]/.test(ch)){state.tokenize=inAttribute(ch);return state.tokenize(stream,state)}else{stream.eatWhile(/[^\s\u00a0=\"\'\/?]/);return"keyword"}}function inAttribute(quote){return function(stream,state){while(!stream.eol()){if(stream.next()==quote){state.tokenize=inPlugin;break}}return"string"}}function inAttributeNoQuote(){return function(stream,state){while(!stream.eol()){var ch=stream.next(),peek=stream.peek();if(" "==ch||","==ch||/[ )}]/.test(peek)){state.tokenize=inPlugin;break}}return"string"}}var curState,setStyle;function pass(){for(var i=arguments.length-1;0<=i;i--){curState.cc.push(arguments[i])}}function cont(){pass.apply(null,arguments);return!0/* ignoreName */ /* skipSlots */}function pushContext(pluginName,startOfLine){var noIndent=curState.context&&curState.context.noIndent;curState.context={prev:curState.context,pluginName:pluginName,indent:curState.indented,startOfLine:startOfLine,noIndent:noIndent}}function popContext(){if(curState.context)curState.context=curState.context.prev}function element(type){if("openPlugin"==type){curState.pluginName=pluginName;return cont(attributes,endplugin(curState.startOfLine))}else if("closePlugin"==type){var err=/* eat */ /* ignoreName */!1/* skipSlots */ /* skipSlots */;if(curState.context){err=curState.context.pluginName!=pluginName;popContext()}else{err=!0}if(err)setStyle="error";return cont(endcloseplugin(err))}else if("string"==type){if(!curState.context||"!cdata"!=curState.context.name)pushContext("!cdata");if(curState.tokenize==inText)popContext();return cont()}else return cont()}function endplugin(startOfLine){return function(type){if("selfclosePlugin"==type||"endPlugin"==type)return cont();if("endPlugin"==type){pushContext(curState.pluginName,startOfLine);return cont()}return cont()}}function endcloseplugin(err){return function(type){if(err)setStyle="error";if("endPlugin"==type)return cont();return pass()}}function attributes(type){if("keyword"==type){setStyle="attribute";return cont(attributes)}if("equals"==type)return cont(attvalue,attributes);return pass()}function attvalue(type){if("keyword"==type){setStyle="string";return cont()}if("string"==type)return cont(attvaluemaybe);return pass()}function attvaluemaybe(type){if("string"==type)return cont(attvaluemaybe);else return pass()}return{startState:function startState(){return{tokenize:inText,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function token(stream,state){if(stream.sol()){state.startOfLine=!0;state.indented=stream.indentation()}if(stream.eatSpace())return null;setStyle=type=pluginName=null;var style=state.tokenize(stream,state);if((style||type)&&"comment"!=style){curState=state;while(!0){var comb=state.cc.pop()||element;if(comb(type||style))break}}state.startOfLine=!1;return setStyle||style},indent:function indent(state,textAfter){var context=state.context;if(context&&context.noIndent)return 0;if(context&&/^{\//.test(textAfter))context=context.prev;while(context&&!context.startOfLine){context=context.prev}if(context)return context.indent+indentUnit;else return 0},electricChars:"/"}});CodeMirror.defineMIME("text/tiki","tiki")});